TERMflow ‚Äì FLOW MODE & COMMAND PALETTE EXTENSION PROMPT

READ CAREFULLY. FOLLOW EXACTLY. DO NOT BREAK EXISTING FUNCTIONALITY.

You are continuing work on TermFlow, a production-grade, terminal-first deep focus system.
This task is an incremental stability + configurability update, NOT a redesign.

Everything that currently works must keep working exactly as-is.

üö® GLOBAL RULES (NON-NEGOTIABLE)

Do NOT remove existing commands

Do NOT break or simplify the command palette

Do NOT revert Flow Mode behavior

Do NOT replace ASCII art with icons/symbols

Keyboard-first only

ESC must always work globally

All animations must be optional & user-controlled

If unsure, choose the least destructive, most configurable approach

üß≠ COMMAND PALETTE ‚Äî STRUCTURE FIX (CRITICAL)
‚ùó Problem to fix

Command palette sometimes glitches, loses focus, or stops responding after mode changes

Some options require search even when users don‚Äôt know what to search

‚úÖ Required behavior

The command palette (:) must:

Never go empty

Never lose focus

Never glitch after Flow Mode enter/exit

Reset cleanly on close

Work identically in normal mode and Flow Mode

Commands must be grouped into visible sections, not search-only.

üß© NEW SECTION: FLOW MODE INTERFACE (VISIBLE ONLY IN FLOW MODE)

Add a dedicated section in the command palette called:

Flow Mode Interface

This section:

Appears ONLY when Flow Mode is active

Is always visible (like ‚ÄúKeys‚Äù, ‚ÄúTheme‚Äù, etc.)

Does NOT require typing/searching to discover options

Options inside Flow Mode Interface

Each option is clickable/selectable via keyboard:

Pomodoro ‚Üí ON / OFF

Reflection ‚Üí ON / OFF

Focus Buddy ‚Üí ON / OFF

Focus Buddy Sub-options (shown ONLY if Buddy = ON)

Focus Buddy Motion ‚Üí ON / OFF

Focus Buddy Position:

Left split

Right split

Inline (uses empty terminal space only)

Focus Buddy Animation Mode

Idle only

Idle + Active Motion

All settings must:

Apply instantly

Persist across sessions

Never break layout

Never require restarting the app

üéØ FLOW MODE ‚Äî UI COMPLETION (DO NOT REDESIGN)

Flow Mode must display:

Pomodoro timer (respecting ON/OFF toggle)

Single-task panel:

Shows ONLY one task at a time

Task list is read-only

When task is marked done ‚Üí next task appears automatically

Reflection panel (only if enabled)

Buttons at the bottom must work consistently, including in Flow Mode
(no dead clicks, no state desync)

üßç FLOW BUDDY ‚Äî BEHAVIOR CLARIFICATION (NO NEW ART YET)
Current acceptable behavior (do NOT expand beyond this yet):

Idle animation:

Uses Idle Frame A + B

Alternates slowly (tail movement)

Only when Buddy = ON

Active motion:

Plays ONLY if user explicitly enables:
‚ÄúIdle + Active Motion‚Äù

Otherwise stays idle-only

‚ö†Ô∏è Do NOT autoplay walking/playing animations
‚ö†Ô∏è Do NOT force motion
‚ö†Ô∏è Do NOT show buddy outside Flow Mode

üß† UX PRINCIPLE (IMPORTANT)

Users must be able to:

Discover Flow Mode settings without knowing search terms

Configure Flow Mode visually from the command palette

Trust that nothing breaks when toggling options

This is a mindset tool, not a toy.

üì¶ SAFETY & STABILITY

Do NOT move files

Do NOT rename entry points

Do NOT break Replit

Keep current layout & proportions

Prepare internally for pip (no activation yet)

‚úÖ FINAL RESPONSE FORMAT (MANDATORY)

After implementation, respond with:

Exact bugs fixed

Flow Mode summary (EXACTLY 3 bullet points)

Command palette improvements summary

Flow Buddy control summary

Pip status: PREPARED