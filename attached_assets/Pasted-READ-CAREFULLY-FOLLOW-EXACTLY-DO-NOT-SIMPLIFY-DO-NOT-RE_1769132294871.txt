READ CAREFULLY. FOLLOW EXACTLY. DO NOT SIMPLIFY. DO NOT REMOVE FEATURES.

You are working on TermFlow, a terminal-first deep focus system.
This is a stability + completion task, not a redesign.

ğŸš¨ GLOBAL RULES (NON-NEGOTIABLE)

Do NOT remove existing commands
Do NOT break the command palette
Do NOT revert features
Do NOT replace ASCII with icons or symbols
Everything must be keyboard-first
ESC must always work
All animations must be optional

If something is unclear, choose the least destructive, most configurable solution.

ğŸ› ï¸ CRITICAL FIXES (DO FIRST)

1ï¸âƒ£ Command Palette : â€” FULL RESTORE

The command palette must:
- Open instantly with :
- Always list ALL commands (keys, theme, quit, screenshot, flow options, buddy options, etc.)
- Support live search filtering
- Never go empty after mode changes
- Never lose focus
- Reset cleanly on close
This includes Flow Modeâ€“specific commands.

2ï¸âƒ£ ESC KEY â€” GLOBAL EXIT

ESC must ALWAYS:
- Exit Flow Mode
- Exit Command Palette
- Exit Help / Info
- Exit overlays or subpanels

Centralize ESC handling.
No dead states. No stuck UI.

ğŸ¯ FLOW MODE â€” FINALIZED BEHAVIOR

Flow Mode:
- Activated with f
- Shows ONLY one task
- Pomodoro auto-starts
- When task is completed â†’ next task appears
- Task list is read-only
- No task editing in Flow Mode

âš™ï¸ FLOW MODE INTERFACE SETTINGS (COMMAND PALETTE)

Add a Flow Interface section with toggles for:
- Pomodoro â†’ ON / OFF
- Reflection â†’ ON / OFF
- Focus Buddy â†’ ON / OFF
- Focus Buddy Motion â†’ ON / OFF
- Focus Buddy Position:
  - Left split panel
  - Right split panel
  - Inline floating (non-blocking empty terminal space)

Settings must:
- Persist across sessions
- Apply instantly
- Never break layout

ğŸ§â€â™‚ï¸ FLOW BUDDY â€” ANIME ASCII SYSTEM (CORE FEATURE)

The Flow Buddy is NOT decoration.
It is a calm, state-aware companion.

Appears ONLY in Flow Mode and ONLY if enabled.
Never overlaps UI.

ğŸ± CAT FLOW BUDDY â€” REQUIRED IMPLEMENTATION

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1ï¸âƒ£ IDLE STATE (TAIL ANIMATION â€” OPTIONAL)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

When Motion = ON, alternate slowly between these frames
(simulating tail movement):

Idle Frame A:

         _     _
        /\`-"-`/\
        )` _ _ `(
    (`\ |=  Y  =|
     ) )_\  ^  /_
    ( (/ ;`-u-`; \
     \| /       \ |
      \ \_ \ / _/ /
 jgs  (,(,,)~(,,),)

Idle Frame B:

         _     _
        /\`-"-`/\
        )` _ _ `(
       {=   Y   =}
        \   ^   /
       /`;'-u-';`\
      | /       \ |
     /\ ;__\ / _/ /
 jgs \___, )~(,,),)
        (_(

Rules:
- Switch every 2â€“3 seconds
- No flicker
- If Motion = OFF â†’ show Frame A only

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2ï¸âƒ£ ACTIVE MOTION SEQUENCE (5 STAGES)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Motion is enabled ONLY if user allows it.
Very slow. Calm. Never distracting.

ğŸŸ¢ STAGE ORDER (STRICT):

Idle â†’ Stand â†’ Walk â†’ Play â†’ Play (alt) â†’ Idle

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STAGE 1 â€” STANDING / READY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

                      ,
                    _/((
           _.---. .'   `\
         .'      `     ^ T=
        /     \       .--'
       |      /       )'-.
       ; ,   <__..-(   '-.)
        \ \-.__)    ``--._)
     jgs '.'-.__.-.
           '-...-'

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STAGE 2 â€” WALKING. playing (5FRAMES, LOOPABLE)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Frame A:
        _
       //
      ||              |\_/|
       \\  .-""""-._,' e e(
        \\/         \  =_Y/=
         \    \       /`"`
          \   | /    |
          /  / -\   /
          `\ \\  | ||
       jgs  \_)) |_))

Frame B:
           _ 
          ((
           \\
            ))       
           //.--.     |\_/|
          |      `'..' a a(
           \  \      \ =_Y/=
           /   |   /  /`"`
           > /` --< <<
      jgs  \__))   \_))

Frame C:
                      __     __,
                      \,`~"~` /
      .-=-.           /    . .\
     / .-. \          {  =    Y}=
    (_/   \ \          \      / 
           \ \        _/`'`'`b
            \ `.__.-'`        \-._
             |            '.__ `'-;_
             |            _.' `'-.__)
              \    ;_..--'/     //  \
              |   /  /   |     //    |
        jgs   \  \ \__)   \   //    /
               \__)        './/   .'
                             `'-'`

frame d:

                   .-o=o-.
               ,  /=o=o=o=\ .--.
              _|\|=o=O=o=O=|    \
          __.'  a`\=o=o=o=(`\   /
          '.   a 4/`|.-""'`\ \ ;'`)   .---.
            \   .'  /   .--'  |_.'   / .-._)
             `)  _.'   /     /`-.__.' /
          jgs `'-.____;     /'-.___.-'
                       `"""`

Rules:
- One frame every 5â€“8 seconds
- No fast looping
- Return to Idle after sequence

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3ï¸âƒ£ FLOW STATE BEHAVIOR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Flow Start â†’ Idle
During Focus â†’ Motion sequence (if enabled)
Flow End â†’ Idle (no motion)

Optional single-word text:
â€œBegin.â€ / â€œFocus.â€ / â€œDone.â€

ğŸ“ BUDDY POSITIONING (MANDATORY)

User chooses via command palette:
- Left split panel
- Right split panel
- Inline floating (empty space only)

Never resize tasks or timer.
Never overlap UI.

ğŸ¨ UI & PERFORMANCE RULES

No redesign
No new colors
No blinking
No emojis
Low refresh rate
Stable layout

ğŸ“¦ PROJECT SAFETY

Do NOT move files
Do NOT rename entry points
Do NOT break Replit
Prepare for pip packaging (do not activate)

âœ… FINAL RESPONSE FORMAT (MANDATORY)

After implementation, respond with:
- Exact bugs fixed
- Flow Mode summary (EXACTLY 3 bullet points)
- Flow Buddy behavior summary
- Pip status: PREPARED or READY

âš ï¸ FINAL WARNING

If you:
- Ignore motion toggle
- Break command palette
- Remove ASCII detail
- Force animation without consent

â†’ Task is FAILED

TermFlow must feel:
Calm. Personal. Intentional. Alive â€” but never distracting.